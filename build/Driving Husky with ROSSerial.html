



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Driving Husky with ROSserial and an Ardunio &mdash; ROS Tutorials 0.5.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/clearpath.css" type="text/css" />
  

  
    <link rel="top" title="ROS Tutorials 0.5.1 documentation" href="index.html"/>
        <link rel="next" title="ROS Parameter Server" href="ROS Parameter Server.html"/>
        <link rel="prev" title="Udev Rules" href="Udev Rules.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

  <!-- Start of clearpathrobotics Zendesk Widget script -->
<script>/*<![CDATA[​*/window.zEmbed||function(e,t){var n,o,d,i,s,a=[],r=document.createElement("iframe");window.zEmbed=function(){a.push(arguments)},window.zE=window.zE||window.zEmbed,r.src="javascript:false",r.title="",r.role="presentation",(r.frameElement||r).style.cssText="display: none",d=document.getElementsByTagName("script"),d=d[d.length-1],d.parentNode.insertBefore(r,d),i=r.contentWindow,s=i.document;try{o=s}catch(c){n=document.domain,r.src='javascript:var d=document.open();d.domain="'+n+'";void(0);',o=s}o.open()._l=function(){var o=this.createElement("script");n&&(this.domain=n),o.id="js-iframe-async",o.src=e,this.t=+new Date,this.zendeskHost=t,this.zEQueue=a,this.body.appendChild(o)},o.write('<body onload="document._l();">'),o.close()}("https://assets.zendesk.com/embeddable_framework/main.js","clearpathrobotics.zendesk.com");/*​]]>*/</script>
<!-- End of clearpathrobotics Zendesk Widget script -->

<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

 ga('create', 'UA-71565737-1', 'auto');
 ga('send', 'pageview');

</script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> ROS Tutorials
          
          </a>
          
            
            <a href="http://www.clearpathrobotics.com/">
            <img src="_static/clearpathlogo.png" class="logo" />
          </a>
          
          

          
            
            
              <div class="version">
                0.5.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search..." />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="simple">
</ul>
<p class="caption"><span class="caption-text">Beginner</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Getting Started with Ubuntu.html">ROS 101: Getting Started with Ubuntu</a></li>
<li class="toctree-l1"><a class="reference internal" href="Intro to the Robot Operating System.html">ROS 101: Intro to ROS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Practical Example.html">ROS 101: A Practical Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="Drive a Husky.html">ROS 101: Drive a Husky</a></li>
<li class="toctree-l1"><a class="reference internal" href="Drive a Grizzly.html">ROS 101: Drive a Grizzly</a></li>
</ul>
<p class="caption"><span class="caption-text">Intermediate</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Creating publisher.html">Creating a Workspace and Publisher</a></li>
<li class="toctree-l1"><a class="reference internal" href="Creating subscriber.html">Creating a Subscriber Using Github</a></li>
<li class="toctree-l1"><a class="reference internal" href="Creating RQT Dashboard.html">Creating a RQT Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="Launch Files.html">Launch Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="Udev Rules.html">Udev Rules</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Driving Husky with ROSSerial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#code">Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#driving-husky">Driving Husky</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ROS Parameter Server.html">ROS Parameter Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="ROS Navigation Basics.html">ROS Navigation Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="Converting ROS bag to CSV.html">Converting ROS Bag to CSV</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Nodelet Everything.html">Nodelet Everything</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">ROS Tutorials</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
     
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="http://support.clearpathrobotics.com">Home</a> &raquo;</li>
      
    <li>Driving Husky with ROSserial and an Ardunio</li>
      <li class="wy-breadcrumbs-aside">
        <div class="roslogo">
      </div>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="driving-husky-with-rosserial-and-an-ardunio">
<h1>Driving Husky with ROSserial and an Ardunio<a class="headerlink" href="#driving-husky-with-rosserial-and-an-ardunio" title="Permalink to this headline">¶</a></h1>
<p>The Arduino family of micro controllers has quickly become a go to board for hobbyist due to its simplicity and ease of use, however often times roboticists must create communication protocols to allow their embedded hardware to communicate with a computer. That&#8217;s where rosserial comes in! Rosserial is a general protocol for sending ROS messages over a serial interface, such as the UART on Arduino. This allows you to easily interface any sensors attached to Arduino into your ROS environment!</p>
<p>This tutorial will get you started  by setting up the Arduino IDE and installing the rosserial libraries. Then, we&#8217;ll test it out by driving the Husky simulation using a neat trick with the Arduino board. It should goes without saying you&#8217;ll need an Arduino to complete this tutorial. We&#8217;ll also be using a Husky simulator, so make sure to run through our :doc: <a class="reference external" href="DriveaHusky">Drive a Husky</a> tutorial if you haven&#8217;t done so yet.</p>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>The first step is to set up your Arduino environment, begin by installing the Arduino IDE and rosserial using:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo apt-get install arduino arduino-core ros-hydro-rosserial ros-hydro-rosserial-arduino
</pre></div>
</div>
<p>Once you open up the Arduino IDE for the first time, a directory named &#8220;sketchbook&#8221; will be created in your home directory. Now we need to import the rosserial library into your arduino IDE. If your sketchbook directory is empty, you may need to create a directory named &#8220;libraries&#8221; inside of it.</p>
<div class="highlight-bash"><div class="highlight"><pre>mkdir ~/sketchbook/libraries
<span class="nb">cd</span> ~/sketchbook/libraries
rosrun rosserial_arduino make_libraries.py .
</pre></div>
</div>
<p>Restart your Arduino IDE and you should see the ros_lib part of your libraries!</p>
<a class="reference internal image-reference" href="_images/ros_lib_check.PNG"><img alt="_images/ros_lib_check.PNG" src="_images/ros_lib_check.PNG" style="width: 322.5px; height: 387.0px;" /></a>
<p>You&#8217;ll want to ensure that your Ubuntu user is part of the &#8220;Dailout&#8221; group, which grants you access to serial ports. You can check by using</p>
<div class="highlight-bash"><div class="highlight"><pre>groups <span class="s2">&quot;username”</span>
</pre></div>
</div>
<p>If you don&#8217;t see &#8220;dailout&#8221;, you can easily add yourself using</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo gpasswd --add <span class="s2">&quot;username&quot;</span> dialout
</pre></div>
</div>
<p>One last step to make our lives easier will be to create udev rules so your Arduino is  recognized when plugged in and the correct permissions are set. For more information on udev rules check out our udev article . Begin by plugging in your Arduino.</p>
<p><strong>NOTE:</strong> If you are using a virtual machine, you will have to connect Arduino to the virtual machine after plugging it in.</p>
<a class="reference internal image-reference" href="_images/attaching_device.jpg"><img alt="_images/attaching_device.jpg" src="_images/attaching_device.jpg" style="width: 662.5px; height: 369.5px;" /></a>
<p>You can confirm your system is actually connected to Arduino by running</p>
<div class="highlight-bash"><div class="highlight"><pre>ls -l /dev
</pre></div>
</div>
<p>You should see a line similar to</p>
<div class="highlight-bash"><div class="highlight"><pre>Bus <span class="m">002</span> Device 005: ID 2341:0043
</pre></div>
</div>
<p>To confirm this is indeed your Arduino, disconnect it and run the command again, taking note which entry has disappeared. Remember the ID numbers, in this case, 2341 is the vendor ID and 0043 is the product ID. Now venture over to your udev rules at:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">cd</span> /etc/udev/rules.d/
</pre></div>
</div>
<p>and create our new rules file, the naming conventions for rules files follows &#8220;##-name.rules&#8221;. Chose a number that isn&#8217;t in use!</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo gedit 97-arduino.rules
</pre></div>
</div>
<p>Copy the following into your new rules file, replacing #### with your product ID and vendor ID. For more information about what these tags mean, check out our article on udev rules.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">SUBSYSTEMS</span><span class="o">==</span><span class="s2">&quot;usb&quot;</span>, <span class="nv">ACTION</span><span class="o">==</span><span class="s2">&quot;add&quot;</span>, ATTRS<span class="o">{</span>idVendor<span class="o">}==</span><span class="s2">&quot;2341&quot;</span>, ATTRS<span class="o">{</span>idProduct<span class="o">}==</span><span class="s2">&quot;00[0-f][0-f]&quot;</span>, <span class="nv">MODE</span><span class="o">=</span><span class="s2">&quot;0666&quot;</span>, SYMLINK+<span class="o">=</span><span class="s2">&quot;arduino arduino_</span><span class="nv">$attr</span><span class="s2">{serial}&quot;</span>, <span class="nv">GROUP</span><span class="o">=</span><span class="s2">&quot;dialout&quot;</span>,
</pre></div>
</div>
<p>All that is left is to update your udev rules and reboot your system</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo udevadm control --reload-rules <span class="o">&amp;&amp;</span> sudo service udev restart <span class="o">&amp;&amp;</span> sudo udevadm trigger
</pre></div>
</div>
<p>You should now see &#8220;arduino&#8221; as an entry in ls -l /dev with full permissions! (rw-rw-rw-)</p>
</div>
<div class="section" id="code">
<h2>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h2>
<p>We&#8217;re now set to upload our code to Arduino! The code is fairly straight forward, however if you have any difficulties following along, check out our &#8220;Creating a publisher&#8221; tutorial. Copy the following code into the Arduino IDE and click upload. If your udev rules were set correctly you should be able to upload without any errors.</p>
<p>If you encounter any errors, verify your arduino is coming up as &#8220;arduino&#8221; in a ls -l /dev and proper permissions are set. You may also have to point the Arduino IDE towards the correct USB port in tools -&gt; serial port.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c">#include &lt;ArduinoHardware.h&gt;</span>
<span class="c">#include &lt;ros.h&gt;</span>
<span class="c">#include &lt;geometry_msgs/Twist.h&gt;</span>

ros::NodeHandle nh<span class="p">;</span>

geometry_msgs::Twist msg<span class="p">;</span>

ros::Publisher pub<span class="o">(</span><span class="s2">&quot;husky/cmd_vel&quot;</span>, <span class="p">&amp;</span>msg<span class="o">)</span><span class="p">;</span>

void setup<span class="o">()</span>
<span class="o">{</span>
 nh.initNode<span class="o">()</span><span class="p">;</span>
 nh.advertise<span class="o">(</span>pub<span class="o">)</span><span class="p">;</span>
<span class="o">}</span> void loop<span class="o">()</span>
<span class="o">{</span>
 <span class="k">if</span><span class="o">(</span>digitalRead<span class="o">(</span>8<span class="o">)==</span>1<span class="o">)</span>
 msg.linear.x<span class="o">=</span>-0.25<span class="p">;</span>

<span class="k">else</span> <span class="k">if</span> <span class="o">(</span>digitalRead<span class="o">(</span>4<span class="o">)==</span>1<span class="o">)</span>
msg.linear.x<span class="o">=</span>0.25<span class="p">;</span>

<span class="k">else</span> <span class="k">if</span> <span class="o">(</span>digitalRead<span class="o">(</span>8<span class="o">)==</span><span class="m">0</span> <span class="o">&amp;&amp;</span> digitalRead<span class="o">(</span>4<span class="o">)==</span>0<span class="o">)</span>
msg.linear.x<span class="o">=</span>0<span class="p">;</span>

pub.publish<span class="o">(</span><span class="p">&amp;</span>msg<span class="o">)</span><span class="p">;</span>
nh.spinOnce<span class="o">()</span><span class="p">;</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="driving-husky">
<h2>Driving Husky<a class="headerlink" href="#driving-husky" title="Permalink to this headline">¶</a></h2>
<p>Now that Arduino is loaded with our code and publishing velocity commands, we can pass these messages along into our ROS environment. We&#8217;ll start by launching a Husky simulation:</p>
<div class="highlight-bash"><div class="highlight"><pre>roslaunch husky_gazebo husky_empty_world.launch
</pre></div>
</div>
<p>All that&#8217;s left is to attach the Arduino into our ROS environment using:</p>
<div class="highlight-bash"><div class="highlight"><pre>rosrun rosserial_python serial_node.py _port:<span class="o">=</span>/dev/arduino
</pre></div>
</div>
<p>We&#8217;re ready to try it out! Go ahead and touch the digital pin 8 and you should see Husky drive forward! Similarly if you touch digital pin 4 Husky will drive backwards.</p>
<img alt="_images/ArduinoUno_r2_front450px.jpg" src="_images/ArduinoUno_r2_front450px.jpg" />
<p>This trick is made possible by a phenomenon known as <a class="reference external" href="http://en.wikipedia.org/wiki/Parasitic_capacitance">parasitic capacitance</a>, which is usually an unwanted effect in electronics design, but serves nicely for the purpose of our example. That being said, this isn&#8217;t the most reliable method, and is intended to provide a simple example with minimal equipment.  If you are having difficulties moving your simulated Husky, try using rostopic echo /husky/cmd_vel to verify some commands are in fact being sent to Husky when you touch the pins.</p>
<p>Be sure to go through the rest of our ROS tutorials on our <a class="reference external" href="http://support.clearpathrobotics.com/">knowledge base</a>. If you want to learn more about ROSserial, be sure to visit the rosserial page of the <a class="reference external" href="http://wiki.ros.org/rosserial">ROS wiki</a>.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ROS Parameter Server.html" class="btn btn-neutral float-right" title="ROS Parameter Server" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Udev Rules.html" class="btn btn-neutral" title="Udev Rules" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Clearpath Robotics.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.5.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>